{"version":3,"sources":["pages/login/Login.js"],"names":["utils","window","borderMove","keyframes","_templateObject","Captcha","styled","div","_templateObject2","AppVersion","_templateObject3","Login","props","_this","Object","_Users_farben_project_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_11__","this","_Users_farben_project_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_13__","_Users_farben_project_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_14__","call","state","forward","model","username","password","base64Img","appVersion","Config","_this2","http","post","then","response","setState","data","body","assign","captchaToken","_this3","form","validateFields","error","values","console","log","getFieldsValue","history","push","getCaptcha","alert","setFieldsValue","_this4","getFieldProps","react__WEBPACK_IMPORTED_MODULE_17___default","a","createElement","antd_mobile_lib_nav_bar__WEBPACK_IMPORTED_MODULE_10___default","mode","leftContent","onClick","className","rightContent","style","backgroundColor","src","width","antd_mobile_lib_list__WEBPACK_IMPORTED_MODULE_6___default","antd_mobile_lib_input_item__WEBPACK_IMPORTED_MODULE_8___default","rules","required","message","clear","placeholder","extra","height","antd_mobile_lib_button__WEBPACK_IMPORTED_MODULE_4___default","login","type","antd_mobile_lib_white_space__WEBPACK_IMPORTED_MODULE_2___default","React","Component","createForm","connect"],"mappings":"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","file":"static/js/login.b8f3bc6a.chunk.js","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { NavBar,List, InputItem, WhiteSpace, Button } from 'antd-mobile';\nimport { createForm } from 'rc-form';\nimport styled,{ keyframes } from 'styled-components';\n\nconst utils = window.utils;\n\nconst borderMove = keyframes`\n  from {}\n  to {\n    background-position: 0 -12px, 100% 12px, 12px 0, -12px 100%;\n  }\n`;\n\nconst Captcha = styled.div`\n  position:absolute;\n  top:4px;\n  right:4px;\n  padding:1px;\n  background: linear-gradient(0deg, transparent 6px, #ccc 6px) repeat-y, linear-gradient(0deg, transparent 50%, #ccc 0) repeat-y, linear-gradient(90deg, transparent 50%, #ccc 0) repeat-x, linear-gradient(90deg, transparent 50%, #ccc 0) repeat-x;\n  background-size: 1px 12px, 1px 12px, 12px 1px, 12px 1px;\n  background-position: 0 0, 100% 0, 0 0, 0 100%;\n  animation: ${borderMove} 1s infinite linear;\n`;\n\nconst AppVersion = styled.div`\n  position:absolute;\n  width:100%;\n  bottom:5px;\n  color:gray;\n  font-size:12px;\n  text-align:center;\n`;\n\nclass Login extends React.Component {\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      forward: false,\n      model: {\n        username: 'admin',\n        password: 'admin'\n      },\n      base64Img: '',\n      appVersion: window.Config.appVersion\n    }\n  }\n\n  getCaptcha(){\n    utils.http.post('/manage/user/captcha').then(response => {\n      this.setState({\n        base64Img: 'data:image/png;base64, '+response.data.body.data.base64Img,\n        model: Object.assign({}, this.state.model, {\n          captchaToken: response.data.body.data.captchaToken\n        })\n      })\n    })\n  }\n\n  login(){\n    this.props.form.validateFields((error, values) => {\n      if (error) {\n        console.log('error', error, values);\n      } else {\n        const model = this.props.form.getFieldsValue().model;\n        model.captchaToken = this.state.model.captchaToken;\n        utils.http.post('/manage/user/login', model).then(response => {\n          if(response.data.body.data) {\n            this.props.history.push('./home');\n          }else{\n            this.getCaptcha();\n          }\n        }, error => {\n          alert('error');\n          this.props.history.push('./home');\n        });\n      }\n    });\n  }\n\n  componentDidMount(){\n    console.log('login')\n    this.getCaptcha();\n\n    this.props.form.setFieldsValue({\n      model:this.state.model\n    });\n  }\n\n  render() {\n    const { getFieldProps } = this.props.form;\n\n    return (\n      <div>\n        <NavBar\n          mode=\"dark\"\n          leftContent={(<i onClick={()=>this.props.history.push('./setting')} className={'fa fa-fw fa-home'} />)}\n          rightContent={(<i onClick={()=>this.props.history.push('./home')} className={'fa fa-fw fa-refresh'} />)}\n        >react-app</NavBar>\n\n        <div className={'pd-md center'} style={{backgroundColor:'white'}}>\n          <img src=\"logo.jpg\" style={{width:'50%'}} />\n        </div>\n\n        <List>\n          <InputItem\n            {...getFieldProps('model.username', {\n              rules:[{\n                required: true,\n                message: '账号不能为空！',\n              }]\n            })}\n            clear\n            placeholder=\"请输入账号\"\n          >账　号</InputItem>\n          <InputItem\n            {...getFieldProps('model.password')}\n            clear\n            placeholder=\"请输入密码\"\n          >密　码</InputItem>\n          <InputItem\n            {...getFieldProps('model.captcha')}\n            clear\n            placeholder=\"请输入验证码\"\n            extra={(\n              <Captcha>\n                <img onClick={()=>this.getCaptcha()} src={this.state.base64Img} style={{width:'100px', height:'36px'}} />\n              </Captcha>\n            )}\n          >验证码</InputItem>\n        </List>\n        <div className={'pd-lg'}>\n          <Button onClick={()=>this.login()} type=\"primary\">登　录</Button><WhiteSpace />\n        </div>\n        <AppVersion>版本号：{this.state.appVersion}</AppVersion>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {...state}\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    header: hasHeader => {\n      dispatch({type:'UI/HERADER', ui: {header:hasHeader}})\n    },\n    login: user => {\n      dispatch({type: 'APP/LOGIN', app: {user:user}})\n    }\n  }\n}\n\nexport default createForm()(connect()(Login))"],"sourceRoot":""}